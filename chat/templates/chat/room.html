<!DOCTYPE html>
<html>
<head>
    <title>Chat Room - {{ room }}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .chat-container {
            display: flex;
            width: 100%;
            max-width: 1200px; /* Adjust based on your preference */
        }

        .sidebar {
            flex: 1;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-right: 20px; /* Space between sidebar and chat display */
        }

        .chat-display {
            flex: 3;
            background-color: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .form-input, .form-button {
            /* Styles for form inputs and buttons */
            padding: 10px;
            margin: 5px 0; /* Spacing between form elements */
        }

        .form-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        </style>
<body>
    <a href="{% url 'home' %}">Back to Rooms</a>
    <div class="chat-container">
        <div class="sidebar">
            <h2>Users</h2>
            {% for user in usernames %}
                <div>{{ user }}</div>
            {% endfor %}
            <h3>Add User</h3>
            <form action="" method="POST">
                {% csrf_token %}
                <input type="text" id="username" name="username" class="form-input" placeholder="Enter username" required>
                <button type="submit" class="form-button">Submit</button>
            </form>
        </div>
        <div class="chat-display" id="display">
            <h1>{{ room }}</h1>
        </div>
    </div>

    <form id="post-form" style="margin-top: 20px;">
        {% csrf_token %}
        <input type="hidden" name="username" id="username" value="{{ username }}">
        <input type="hidden" name="room_id" id="room_id" value="{{ room_details.id }}">
        <input type="text" name="message" id="message" class="form-input" placeholder="Type your message here...">
        <input type="submit" value="Send" class="form-button">
    </form>

    <script>
        $(document).ready(function(){
        setInterval(function(){
            $.ajax({
                type: 'GET',
                url : "/getMessages/{{room}}/",
                success: function(response){
                    console.log(response);
                    $("#display").empty();
                    for (var key in response.messages)
                    {
                        var temp="<div class='container darker'><b>"+response.messages[key].user+": "+response.messages[key].content+"</p><span class='time-left'>"+"</div>";
                        $("#display").append(temp);
                    }
                },
                error: function(response){
                    alert('An error occured')
                }
            });
        },500);
        })
    </script>
    <script type="text/javascript">
        $(document).on('submit','#post-form',function(e){
          e.preventDefault();
      
          $.ajax({
            type:'POST',
            url:'/send',
            data:{
                username:$('#username').val(),
                room_id:$('#room_id').val(),
                message:$('#message').val(),
              csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
            },
            success: function(data){
            }
          });
          document.getElementById('message').value = ''
        });
      </script>
</body>
</html>
